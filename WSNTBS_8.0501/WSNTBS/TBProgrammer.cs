
/*
 * TBProgrammer.cs
 * Wireless Sensor Network Testbed Programmer Class
 *
 * Author:
 * Wei-Sheng Yang (Rick) rick@axp1.csie.ncu.edu.tw
 *
 * Copyright By
 * High Speed Communication and Computing Lab (HSCC)
 * National Central University (NCU)
 * National Tsing Hua University (NTHU)
 */

using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Diagnostics;
using System.Windows.Forms;
using System.Threading;

namespace WSNTBS
{
    class TBProgrammer
    {
        // Data member
        private int    m_NodeID ;       
        private string m_BinaryFile ;   
        private string m_COMPort;       
        private string m_ResultLogs;    

        // every instance of TBProgrammer shares the same Semaphore
        public static Semaphore smp = null ;

        public static void SetMaximumProgrammingThread(int max_thread)
        {
            smp = new Semaphore(max_thread, max_thread);
        }

        /// <summary>
        /// Constructor
        /// </summary>
        /// <param name="inNodeID"> Node ID</param>
        /// <param name="inFilename"> Binary File Name </param>
        /// <param name="inCOMPort"> Connected Serial Port </param>
        public TBProgrammer(int inNodeID,string inFilename,string inCOMPort)
        {
            m_NodeID     = inNodeID ;
            m_BinaryFile = inFilename ;
            m_COMPort    = inCOMPort;
            m_ResultLogs = "";

            if (smp == null)
                SetMaximumProgrammingThread(4);
        }

        /// <summary>
        /// Create Default Program
        /// if no file specified, the defalut code winn be installed
        /// </summary>
        /// <param name="inFilename"> Destination File Name</param>
        public void CreateDefaultProgram(string inFilename)
        {
            if (!Directory.Exists(ServerInfo.TEMP_DIRECTORY))
                Directory.CreateDirectory(ServerInfo.TEMP_DIRECTORY);

            // create Blink ihex file
            StreamWriter sw = new StreamWriter( ServerInfo.TEMP_DIRECTORY + "\\" + inFilename);
            sw.WriteLine(":10400000B240805A20013F40EE463E4000113D4004");
            sw.WriteLine(":1040100000110D9E0524FE4F00001E530E9DFB2B2C");
            sw.WriteLine(":104020003F4000113D4000110D9F0524CF4300008B");
            sw.WriteLine(":104030001F530F9DFB2B3040404030403E4000134B");
            sw.WriteLine(":104040003140F83832C20343B012CE41F24087FF0C");
            sw.WriteLine(":104050005700F240E0FF5600F2D080FF1E00F2D081");
            sw.WriteLine(":1040600010001E00F2D080FF1D000E435F42700062");
            sw.WriteLine(":104070007FF025007F902500A5244E930324F2F0C5");
            sw.WriteLine(":10408000DAFF7000D2437000F2D016007000F2D058");
            sw.WriteLine(":10409000A2FF7100E2437400C2437500C243730083");
            sw.WriteLine(":1040A000F2D040000400D2C370000E433F433F53A0");
            sw.WriteLine(":1040B000FE231E532E92FA3BC29328000E38B012F4");
            sw.WriteLine(":1040C000CE41B01212424E437F400700B01242422E");
            sw.WriteLine(":1040D000B140F800060012D106003B407010B0124B");
            sw.WriteLine(":1040E000BA424F9302243B40F0100D410F4B3E402B");
            sw.WriteLine(":1040F0000500ED4F00001F531D533E533E93F9231F");
            sw.WriteLine(":104100005E4105005EB304207ED0FDFFC14E050078");
            sw.WriteLine(":10411000B2403002A001B2400002A201F2409BFF77");
            sw.WriteLine(":1041200080003F4000363F50E5FFFD23A2D3A001B1");
            sw.WriteLine(":1041300092D3A00192B3A401FD27A2C3A0018243A0");
            sw.WriteLine(":10414000A0010F43B290670E400101281F437FF387");
            sw.WriteLine(":104150004F9306205F43B012E042B01218431D3C5B");
            sw.WriteLine(":10416000D1530400E19304001F287F400700B012E0");
            sw.WriteLine(":10417000E0420E433F400F00B01234436F931124CE");
            sw.WriteLine(":10418000B0121843F1430400E1D305003D4006009E");
            sw.WriteLine(":104190000E413F407000B0123046B0121242B012D1");
            sw.WriteLine(":1041A000004882432001EC3F3D4006000E413F4065");
            sw.WriteLine(":1041B0007000B0123046E1B30500E2232E411F41EA");
            sw.WriteLine(":1041C0000200DA3F1E43593F31523040C646F240AA");
            sw.WriteLine(":1041D0000E001B00F240E0FF2200C2432100F2402B");
            sw.WriteLine(":1041E0007B002A00F24010002900F240F1FF1A0083");
            sw.WriteLine(":1041F000C2431900F240FDFF1E00F240DDFF1D002A");
            sw.WriteLine(":10420000F2433200F2433100F2433600C24335003C");
            sw.WriteLine(":104210003041F2F0EFFF1D00F240B9FF7700D2B35A");
            sw.WriteLine(":10422000710005241F437FF34F93F927023C0F438E");
            sw.WriteLine(":10423000FA3FF2D010001D00F2F0BFFF04001F4350");
            sw.WriteLine(":1042400030410B120A120912494F4A4E3B400006F8");
            sw.WriteLine(":104250004F49B01280420F4B0B9302243F53FE2371");
            sw.WriteLine(":104260004F4AB01280423F4000060F8B02243F535A");
            sw.WriteLine(":10427000FE232B821B93EC3739413A413B413041BD");
            sw.WriteLine(":104280004E4F6FF31624F2F0DFFF31006EB20D24B3");
            sw.WriteLine(":10429000F2F0BFFF31005EB30424F2F0EFFF310013");
            sw.WriteLine(":1042A0003041F2D0100031003041F2D040003100F6");
            sw.WriteLine(":1042B000F23FF2D020003100E93F5E427F105F42C2");
            sw.WriteLine(":1042C000FF107E930B247F9307240D434E8F023003");
            sw.WriteLine(":1042D0000F4D30411D43FC3F0F4330411F433041E0");
            sw.WriteLine(":1042E0000B120A124A4F7B4003004F4AB012804221");
            sw.WriteLine(":1042F0006E423F433F53FE237E53FB234F43B01296");
            sw.WriteLine(":1043000080426E423F433F53FE237E53FB237B5349");
            sw.WriteLine(":10431000EC233A413B4130410B127F4007004B4FA9");
            sw.WriteLine(":1043200012C34B104E4BB01242424F4B4B93F723EC");
            sw.WriteLine(":104330003B4130410B120A120912081207120612F1");
            sw.WriteLine(":104340000512041231800602084E094F3E50070044");
            sw.WriteLine(":104350000F63B0125845B012E445474FF2D0100039");
            sw.WriteLine(":104360001D004F93EB247F93E9240E480F493E50E4");
            sw.WriteLine(":1043700010000F63814E0002814F0202B140000124");
            sw.WriteLine(":1043800004023B405003444344978F280F43449713");
            sw.WriteLine(":104390008A244F9302201E43D33C38509001096376");
            sw.WriteLine(":1043A0000E480F49B0125845B0121046064FB012D1");
            sw.WriteLine(":1043B0001046074F38520963369000480424F2D063");
            sw.WriteLine(":1043C00010001D00E83F0F9302200E43B93C0F463A");
            sw.WriteLine(":1043D0008F104A4F12C30A100E480F49B0125845A9");
            sw.WriteLine(":1043E0000F463FF0FF010B410B5FB012E445CB4F8E");
            sw.WriteLine(":1043F000000016531853096337534C240F468F108F");
            sw.WriteLine(":104400007FF312C30F100A9F02200793E923F2D013");
            sw.WriteLine(":1044100010001D004F4AB01280420E4A0F430A4E50");
            sw.WriteLine(":104420000B4F3C4000020D43B012CA460C410D43F5");
            sw.WriteLine(":104430003E90FFFE2D2CB24084A52A01B24000A57B");
            sw.WriteLine(":104440002C01B24002A528018E430000B24040A5D5");
            sw.WriteLine(":1044500028013E90FEFF18240F4D0F5F0F5CAE4FFA");
            sw.WriteLine(":1044600000001D532E533D900001F32BB24000A5D8");
            sw.WriteLine(":104470002801B24010A52C011F437FF32E434F9318");
            sw.WriteLine(":104480005F240793A423A13FBE4000400000E93F02");
            sw.WriteLine(":104490000F43F33FB0121046064FB0121046074FBD");
            sw.WriteLine(":1044A00038520963AB3F1F43743F4A440F4A0F5FC2");
            sw.WriteLine(":1044B0000E4F0F431E5100021F610202B0125845F9");
            sw.WriteLine(":1044C000B012E445464FB012E4457FF38F1006DF8B");
            sw.WriteLine(":1044D000F2D010001D001E4104020F431E510002C5");
            sw.WriteLine(":1044E0001F610202B012584505430B931420F2D00D");
            sw.WriteLine(":1044F00010001D001A533C4050040B430D43B012F2");
            sw.WriteLine(":10450000EA46814E04023B405004545344973E2FE8");
            sw.WriteLine(":104510000695CB273B3FB012E4457FF38F100FE5A4");
            sw.WriteLine(":104520007E420F9309340F5F3FE021107E53F92341");
            sw.WriteLine(":10453000054F3B53F023DB3F0F5FF83F0F43293F0D");
            sw.WriteLine(":104540000F4E315006023441354136413741384132");
            sw.WriteLine(":1045500039413A413B4130410B120A120B4E0C4F8C");
            sw.WriteLine(":10456000F2F0EFFF1D004E43F240ABFF7700C29325");
            sw.WriteLine(":1045700002002F34F2F07F0002001F437FF34F93BD");
            sw.WriteLine(":10458000F6275E537E900500EF2BF2D010001D0041");
            sw.WriteLine(":10459000F2F0EFFF1D003CD000037A4018004D4AB6");
            sw.WriteLine(":1045A0008D110E4B0F4C0D93052412C30F100E10DE");
            sw.WriteLine(":1045B0001D83FB23C24E7700C29302000834F2F041");
            sw.WriteLine(":1045C0007F0002001F437FF34F93F627043C0F4305");
            sw.WriteLine(":1045D000FA3F0F43D33F7A827AB08000E0373A4106");
            sw.WriteLine(":1045E0003B4130415F427600C2437700F2B0400069");
            sw.WriteLine(":1045F00002000824F2F0BFFF02001F437FF34F9335");
            sw.WriteLine(":10460000F527023C0F43FA3F5F4276007FF33041CB");
            sw.WriteLine(":104610000B12B012E4454B4FB012E4457FF38F10FC");
            sw.WriteLine(":104620000BDFB012E445B012E4450F4B3B41304183");
            sw.WriteLine(":104630000B120A1209120B4F094D0A4EB012BA4260");
            sw.WriteLine(":104640004F932D243B5000103E4000103C40801002");
            sw.WriteLine(":10465000B24084A52A01B24000A52C01B24002A5B7");
            sw.WriteLine(":104660002801CE430000B24040A528010D430E9B17");
            sw.WriteLine(":1046700004280F4B0F590E9F0E28EE4C00001D53BF");
            sw.WriteLine(":104680001E531C533D907F00F22B6F4C5F537F9362");
            sw.WriteLine(":104690000D204F430B3CEE4A00001A53F03F3B50B5");
            sw.WriteLine(":1046A00080103E4080103C400010D23FCE4F0000B2");
            sw.WriteLine(":1046B000B24000A52801B24010A52C011F4339418A");
            sw.WriteLine(":1046C0003A413B41304102DFFE3F0E430F43083C7D");
            sw.WriteLine(":1046D00012C30D100C1002280E5A0F6B0A5A0B6BE6");
            sw.WriteLine(":0E46E0000C93F6230D93F42330413040CA466C");
            sw.WriteLine(":10480000B240805A20013F403A533E4000113D40A3");
            sw.WriteLine(":1048100002110D9E0524FE4F00001E530E9DFB2B22");
            sw.WriteLine(":104820003F4002113D4029110D9F0524CF43000058");
            sw.WriteLine(":104830001F530F9DFB2B30405C4830403E48001317");
            sw.WriteLine(":104840000F4212C30F100F110F115FF332C2034357");
            sw.WriteLine(":104850007FF330414F93012432D23041314000394F");
            sw.WriteLine(":10486000B01240484A4F3F402611FF4300001F53FB");
            sw.WriteLine(":104870003F902811FA23F2432411F2432811B01279");
            sw.WriteLine(":104880008050A242600182432E01A24280018243F5");
            sw.WriteLine(":104890001E01B01284515F4257007FF007007FD0A5");
            sw.WriteLine(":1048A00080FFC24F5700E2425800E2C3000082433B");
            sw.WriteLine(":1048B00070018243600182439001B2400201800195");
            sw.WriteLine(":1048C0001F4260013FF0CFFF3FD02000824F6001C8");
            sw.WriteLine(":1048D0001F4280013FF0CFFF3FD02000824F800178");
            sw.WriteLine(":1048E0004B434F4BB0120C525B537B93FA23B012E5");
            sw.WriteLine(":1048F0001C514F43B01262494F93FB234F4AB012F1");
            sw.WriteLine(":10490000544832D2F24316117F435F537F93FD2305");
            sw.WriteLine(":10491000C24F16113C40E8030D434E434F43B012C3");
            sw.WriteLine(":10492000FA505F43B0126249FC3F304036534F9318");
            sw.WriteLine(":104930000324E2D31900023CE2C31900F2D21900A9");
            sw.WriteLine(":10494000F2C2190030410D4F5E4257007EF0F8FF71");
            sw.WriteLine(":104950008F107FF007004EDFC24E5700C24D560049");
            sw.WriteLine(":1049600030410B120A120912494FB01240484A4F07");
            sw.WriteLine(":104970005E4224117E930C244F4ED24F26112411F7");
            sw.WriteLine(":10498000F29324110220F24328114F4EFF432611C7");
            sw.WriteLine(":104990004B4E7E93092049930224B012484F4F4A50");
            sw.WriteLine(":1049A000B01254480F432F3C4F4AB01254484F4B5B");
            sw.WriteLine(":1049B0000F9303241F931F24253CC2930A11122036");
            sw.WriteLine(":1049C0001E421C111F421E111E5218111F621A1185");
            sw.WriteLine(":1049D000824E1C11824F1E111C4218111D421A11C9");
            sw.WriteLine(":1049E000B012044C1E421C111F421E111E521811FF");
            sw.WriteLine(":1049F0001F621A11053CB2F0EFFF8201B0124C4B5E");
            sw.WriteLine(":104A0000B0120E4A1F4339413A413B4130410B122B");
            sw.WriteLine(":104A10000A12091208120712061205120412218244");
            sw.WriteLine(":104A2000054E064FB1430000B140FF7F02004443F2");
            sw.WriteLine(":104A30000B43084B385010115F4B10116FF34E248D");
            sw.WriteLine(":104A40000F4B0F5F0F5F0F5F0D4F3D500211094578");
            sw.WriteLine(":104A50000A46198F02111A7F04110E490F4A194D87");
            sw.WriteLine(":104A600004001A4D0600098E0A7F57430F931F3822");
            sw.WriteLine(":104A70001E8D04001F7D06001A285F4B10115FF386");
            sw.WriteLine(":104A80000424EBC3101147430A3C9D5D0400000061");
            sw.WriteLine(":104A90009D6D06000200195D04001A6D06004F4B63");
            sw.WriteLine(":104AA0007FF31F9304340F930220B01250514793A9");
            sw.WriteLine(":104AB00015246F486FF312240A93053481430000D4");
            sw.WriteLine(":104AC000814302000A3C0E490F4A2E811F710200E9");
            sw.WriteLine(":104AD000043481490000814A020054431B531B9354");
            sw.WriteLine(":104AE000A83B44932924B0124C4B0A4E0B4F0E8521");
            sw.WriteLine(":104AF0000F760C4E0D4F2C811D7102000A28B0124A");
            sw.WriteLine(":104B000040484B4F5F43B012D44B4F4BB012544808");
            sw.WriteLine(":104B1000133C2C411D4102000C8E0D7F824A1C115A");
            sw.WriteLine(":104B2000824B1E11824C1811824D1A11D2430A1168");
            sw.WriteLine(":104B30000E4A0F4BB012044C2152344135413641DC");
            sw.WriteLine(":104B40003741384139413A413B4130410B120A1259");
            sw.WriteLine(":104B50000912B0124048494F1A420C111B420E1163");
            sw.WriteLine(":104B6000B012C24B0E4F1F4280015FF37FF34F9391");
            sw.WriteLine(":104B700005241A530B63B012C24B0E4F0F4E12C3D3");
            sw.WriteLine(":104B80000F100F110F110F110F110C4F0D430E4A83");
            sw.WriteLine(":104B90000F4B4FEE0FEE8F107EF38E100E5E0F6FE9");
            sw.WriteLine(":104BA0000E5E0F6F0A4E0B4F0A5A0B6B0ADC0BDDC1");
            sw.WriteLine(":104BB0004F49B01254480E4A0F4B39413A413B41DC");
            sw.WriteLine(":104BC00030411E4290013D4090010F4E2E4D0F9EF0");
            sw.WriteLine(":104BD000FC2330414E4F7FF3FF9326111120C29EDC");
            sw.WriteLine(":104BE00028110E24F29324110320C24E2411043CF8");
            sw.WriteLine(":104BF0005F422811CF4E2611C24E28111F4330416B");
            sw.WriteLine(":104C00000F4330410B120A120912081207120A4E02");
            sw.WriteLine(":104C10000B4F084C094DB0124048474F824A1211C1");
            sw.WriteLine(":104C2000824B14118248201182492211B012424C49");
            sw.WriteLine(":104C30004F47B01254483741384139413A413B411E");
            sw.WriteLine(":104C400030410B120A1209120812B0124C4B0A4ED4");
            sw.WriteLine(":104C50000B4F0F4E0F5F0F5F0F5F0F5F094F09592B");
            sw.WriteLine(":104C60000E4A0F4B1E8212111F7214110C4E0D4F63");
            sw.WriteLine(":104C70001C8220111D7222110C2892522011121137");
            sw.WriteLine(":104C800092622211141182432011824322110E4399");
            sw.WriteLine(":104C90002E3C1C4220111D4222110C8E0D7F0E4C09");
            sw.WriteLine(":104CA0000F4D3E8001040F7311283A5000040B632E");
            sw.WriteLine(":104CB000824A1211824B14113C5000FC3D63824C1D");
            sw.WriteLine(":104CC0002011824D22113E400080113C9252201151");
            sw.WriteLine(":104CD0001211926222111411824320118243221177");
            sw.WriteLine(":104CE0000F4C0F5F0F5F0F5F0F5F0F5F0E4F0F498E");
            sw.WriteLine(":104CF000B012FE4C384139413A413B4130410B1230");
            sw.WriteLine(":104D00000A120B4F0A4EB012C24B0E4F0E8B0E9A68");
            sw.WriteLine(":104D1000042C0A8E3A900300042CB012C24B2F537D");
            sw.WriteLine(":104D2000013C0F5A824F92013F4082019FC3000015");
            sw.WriteLine(":104D3000BFD0100000003A413B4130410B120A1233");
            sw.WriteLine(":104D4000091208123C400A000C510A4D0B4E384C17");
            sw.WriteLine(":104D5000394C2C825D4C04004E4F0F4E0F5F0F5F9D");
            sw.WriteLine(":104D60000F5F3F5002118F4A00008F4B02008F48A7");
            sw.WriteLine(":104D700004008F4906004F4D5FF3DEC31011CEDFF4");
            sw.WriteLine(":104D80001011EED31011B01240484B4F5F43B012D8");
            sw.WriteLine(":104D9000D44B4F4BB0125448384139413A413B4112");
            sw.WriteLine(":104DA00030410F120E120D120C12B012BE4D3C41CA");
            sw.WriteLine(":104DB0003D413E413F41B1C0F000000000131F42A1");
            sw.WriteLine(":104DC00062018F105FF302241F42720130411F42C3");
            sw.WriteLine(":104DD00064018F105FF302241F42740130411F42AF");
            sw.WriteLine(":104DE00066018F105FF302241F42760130410F12DB");
            sw.WriteLine(":104DF0000E120D120C121F422E0112C34F107FF320");
            sw.WriteLine(":104E00001F930B242F9303340F9304240B3C2F93F5");
            sw.WriteLine(":104E10000724083CB012BE4D053CB012CE4D023CFA");
            sw.WriteLine(":104E2000B012DE4D3C413D413E413F41B1C0F0003A");
            sw.WriteLine(":104E3000000000130F120E120D120C124F43B0128D");
            sw.WriteLine(":104E4000544E3C413D413E413F41B1C0F000000065");
            sw.WriteLine(":104E5000001330410B124E4F7FF33F925E2C0F5FD9");
            sw.WriteLine(":104E6000104F644E744EB04EC04ED04EE04EF04ED9");
            sw.WriteLine(":104E7000004F104F1F4282018F105FF303241F4227");
            sw.WriteLine(":104E800092014E3CB2F0EFFF8201829320110D207F");
            sw.WriteLine(":104E9000829322110A20B01240484B4F4F43B01268");
            sw.WriteLine(":104EA000D44B4F4BB01254483B3CB012424C383CB0");
            sw.WriteLine(":104EB0001F4284018F105FF333241F429401303C62");
            sw.WriteLine(":104EC0001F4286018F105FF32B241F429601283C5E");
            sw.WriteLine(":104ED0001F4288018F105FF323241F429801203C5A");
            sw.WriteLine(":104EE0001F428A018F105FF31B241F429A01183C56");
            sw.WriteLine(":104EF0001F428C018F105FF313241F429C01103C52");
            sw.WriteLine(":104F00001F428E018F105FF30B241F429E01083C4D");
            sw.WriteLine(":104F100092530C1182630E11033C4F4EB012524E4D");
            sw.WriteLine(":104F20003B4130410F120E120D120C121F421E0196");
            sw.WriteLine(":104F300012C34F10B012544E3C413D413E413F41DF");
            sw.WriteLine(":104F4000B1C0F00000000013218381430000C29330");
            sw.WriteLine(":104F50000011022432D2923CB140D00000005F42E6");
            sw.WriteLine(":104F600004007FF0C0FF05245F4271007FF0200045");
            sw.WriteLine(":104F70005F205F4205007FF0300005245F4279002A");
            sw.WriteLine(":104F80007FF0200055205F4270005FF313245F42E2");
            sw.WriteLine(":104F900071007FF020000E245F4272007FF020003D");
            sw.WriteLine(":104FA00009245F4270006FF205245F4270007FF0B9");
            sw.WriteLine(":104FB00020003E201F4260013FF0300007241F42C6");
            sw.WriteLine(":104FC00060013FF000033F90000232241F42E001E5");
            sw.WriteLine(":104FD0003FF010000B241F4222011FF307241F4241");
            sw.WriteLine(":104FE00060013FF000033F90000222241F42E801CD");
            sw.WriteLine(":104FF0003FF010000C241F4222013FF01000072454");
            sw.WriteLine(":105000001F4260013FF000033F90000211241F4245");
            sw.WriteLine(":10501000F0013FF010000F241F4222013FF0000179");
            sw.WriteLine(":105020000A241F4260013FF000033F90000203206A");
            sw.WriteLine(":10503000B140500000001F42A2011FF31C241F4278");
            sw.WriteLine(":10504000A0014F9307381F4260013FF000033F90DB");
            sw.WriteLine(":1050500000020E241F42A2013FF018003F901000F2");
            sw.WriteLine(":1050600004243F9018000424063C81430000033CC4");
            sw.WriteLine(":10507000B14050000000B1D2000022D12153304194");
            sw.WriteLine(":10508000C2432600C2432E00C2431B00C2431F007E");
            sw.WriteLine(":10509000C2433300C2433700F240E0FF2200C24364");
            sw.WriteLine(":1050A0002100F2407B002A00F24010002900F2406B");
            sw.WriteLine(":1050B000F1FF1A00C2431900F240FDFF1E00F2404A");
            sw.WriteLine(":1050C000DDFF1D00F2433200F2433100F2433600AF");
            sw.WriteLine(":1050D000C2433500C2432500C2432D003E40002894");
            sw.WriteLine(":1050E0000F430F9E072C03430343034303431F5304");
            sw.WriteLine(":1050F0000F9EF92BB012AA5230415E9305200E4D3F");
            sw.WriteLine(":105100000D4CB0127E52063C4E9306200E4D0D4CB7");
            sw.WriteLine(":10511000B01252521F4330410F433041C243171166");
            sw.WriteLine(":10512000F2D010003200F2D23200F2D02000320071");
            sw.WriteLine(":10513000F2D040003200F2D040003100F2D0100036");
            sw.WriteLine(":105140003100F2D23100F2D0200031001F43304153");
            sw.WriteLine(":105150000B12B01240484E4F5F4217116FF20624F7");
            sw.WriteLine(":10516000F2D010003100E2C21711053CF2F0EFFF5F");
            sw.WriteLine(":105170003100E2D217115B434F4EB01254484F4BEF");
            sw.WriteLine(":105180003B4130410B120A120912B2402002600169");
            sw.WriteLine(":10519000B24020018001F24084FF5700C243580012");
            sw.WriteLine(":1051A000B2400040820109433A4000080F490FDA3B");
            sw.WriteLine(":1051B0000B43B01246495E431F4290013F52824F5B");
            sw.WriteLine(":1051C000920192C382011F4282011FF3FC270D4B03");
            sw.WriteLine(":1051D0001B4270014F4E7E535F93EE370F4B0F8D86");
            sw.WriteLine(":1051E0003F900104012C09DA0A110A93DF230F49C9");
            sw.WriteLine(":1051F0003FF0E0003F90E000022039F0E0FF0F496F");
            sw.WriteLine(":10520000B012464939413A413B4130417FF30F9357");
            sw.WriteLine(":105210001D20B01222530C433D4002113E400700B6");
            sw.WriteLine(":10522000CD4C00001D533E533E93FA230C433D40AA");
            sw.WriteLine(":1052300010110E43CD4C00001D533E533E93FA23F4");
            sw.WriteLine(":105240004F9302241F43033C0F43013C4F437FF322");
            sw.WriteLine(":1052500030410B120A120912494F0A4D0B4EB0127F");
            sw.WriteLine(":105260004C4B43120B120A120D4E0E4F4F49B01207");
            sw.WriteLine(":105270003C4D3150060039413A413B4130410B121F");
            sw.WriteLine(":105280000A120912494F0A4D0B4EB0124C4B5312E1");
            sw.WriteLine(":105290000B120A120D4E0E4F4F49B0123C4D3150B9");
            sw.WriteLine(":1052A000060039413A413B413041E2D31A00F2D283");
            sw.WriteLine(":1052B0001A00F2D080FF1E00F2D010001E00F2D0C3");
            sw.WriteLine(":1052C00080FF1D00F2D010001D0003430343F2F0E5");
            sw.WriteLine(":1052D000EFFF1D00F2C219005F43B0122E494F4389");
            sw.WriteLine(":1052E000B0122E495F43B0122E495F43B0122E49CF");
            sw.WriteLine(":1052F0005F43B0122E494F43B0122E494F43B012B4");
            sw.WriteLine(":105300002E495F43B0122E49F2D010001D00E2D3A7");
            sw.WriteLine(":105310001900E2C31A00F2C21A00F2F07F001D0069");
            sw.WriteLine(":1053200030413F408201BFF0EFFF0000BF4000402E");
            sw.WriteLine(":0A53300000001F43304102DFFE3F82");
            sw.WriteLine(":02533A00000071");
            sw.WriteLine(":10FFE0003A483A483A483A483A48EE4DA24D3A48DB");
            sw.WriteLine(":10FFF0003A483A483A483A48244F344E3A48004042");
            sw.WriteLine(":0400000300004800B1");
            sw.WriteLine(":00000001FF");
            sw.Close();
        }

        public void Install()
        {
            // if no programming file specified, install the default program
            if ( m_BinaryFile == "" )
            {
                m_BinaryFile = "_TBDefaultCode" + m_NodeID.ToString() + ".ihex" ;
                CreateDefaultProgram(m_BinaryFile);
            }

            // if the node id is valid
            if (m_NodeID > 0)
            {
                smp.WaitOne();
                try
                {     
                    m_ResultLogs = "Failed";

                    // install allmost 3 time
                    for (int i = 0; i < 3; ++i)
                    {
                        Octopus2bsl bsl = new Octopus2bsl();
                        int ProgramErrorCode = bsl.program_start( ServerInfo.TEMP_DIRECTORY + "\\" + m_BinaryFile , m_COMPort) ;
                        if ( ProgramErrorCode == 0)
                        {
                            m_ResultLogs = "Successful. (" + m_BinaryFile + " to " + m_COMPort + " )";
                            break;
                        }

                        if (ProgramErrorCode == 1)
                        {
                            m_ResultLogs = "Successful. (COMPort does not existed)";
                            break;
                        }
                        m_ResultLogs = "Failed. ErrorCode is " + ProgramErrorCode.ToString() ;
                    }
                    
                }
                catch (Exception ex)
                {
                    m_ResultLogs = "Failed. (Exception Occur: " + ex.ToString();
                    smp.Release();
                }
                smp.Release();
            }
        }

        public void ResetNodes()
        {
            Octopus2bsl bsl = new Octopus2bsl();
            bsl.Reset(m_COMPort);
        }

        public string GetResultLogs()
        {
            return m_ResultLogs;
        }
    }
}
